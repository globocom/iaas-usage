<div ng-controller="InstanceCtrl as instanceCtrl">
    <div class="row wrapper border-bottom white-bg page-heading" >
        <div class="col-lg-10">
            <h2>
                {[ instanceCtrl.projectName ]} {[ instanceCtrl.title ]}
            </h2>
            <ol class="breadcrumb">
                <li>
                    Instances
                </li>
                <li>
                    <a ui-sref="index.projects">Projects</a>
                </li>
                <li>
                    <a>{[ instanceCtrl.projectName ]}</a>
                </li>
            </ol>
        </div>
        <div class="col-lg-2">
        </div>
    </div>
    <div class="wrapper wrapper-content animated fadeInRight" ng-init="instanceCtrl.listVirtualMachines()">
        <div class="col-lg-16">
            <div class="ibox">
                <div class="ibox-title">
                    <h5>Filter by tags:</h5>

                    <div class="ibox-tools tag-selector">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="true" onclick="return false;">
                            <i class="fa fa-tags"></i>
                        </a>
                        <div class="dropdown-menu dropdown-user">
                            <form class="form-horizontal m-t-md" action="#">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Tag Key</label>
                                    <div class="col-sm-7">
                                        <input type="text" class="form-control" ng-model="instanceCtrl.tagKey">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Tag value</label>
                                    <div class="col-sm-7">
                                        <input type="text" class="form-control" ng-model="instanceCtrl.tagValue">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-7">
                                        <button class="btn btn-sm btn-primary pull-right m-t-n-xs" type="button" ng-click="instanceCtrl.filterByTag(instanceCtrl.tagKey, instanceCtrl.tagValue)">
                                            <strong>Ok</strong>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="ibox-content" ng-show="instanceCtrl.tags.length > 0" style="padding: 1px 20px 5px 20px">
                    <div class="row">
                        <ul class="tag-list" style="padding: 0">
                            <li  ng-repeat="tag in instanceCtrl.tags" ng-click="instanceCtrl.removeTagFilter(tag.key, tag.value)">
                                <a href="#" class="help" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Click on tag to remove it from filter">
                                    <i class="fa fa-tag"></i> {[tag.key]} = {[tag.value]}
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div ng-show="instanceCtrl.instances.length > 0">
            <div class="row">
                <div class="col-lg-4" >
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Compute Offering</h5>
                            <a class="fa fa-question-circle tip" data-toggle="tooltip" data-placement="top" title="" data-original-title="Compute Offering define características e capacidades da instância como número de CPUs, velocidade de CPUs, tamanho de memória RAM e outros."></a>
                        </div>
                        <div class="ibox-content vm-feature-box">
                            <table class="table table-bordered" >
                                <thead>
                                    <tr>
                                        <th>Compute Offering</th>
                                        <th>Instances</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="vm-feature" ng-class="{'feature-filter': instanceCtrl.isFilteredField('service_offering_name', item.name)}" ng-repeat="item in instanceCtrl.getVmCountByFeature('serviceofferingname') | orderBy:'-count'" >
                                        <td  ng-click="instanceCtrl.filter('service_offering_name', item.name)">{[item.name]}</td>
                                        <td  ng-click="instanceCtrl.filter('service_offering_name', item.name)">{[item.count]}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4" >
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>State</h5>
                            <a class="fa fa-question-circle tip" data-toggle="tooltip" data-placement="top" title="" data-original-title="Estado corrente da instância, podendo ser Starting, Running, Stopping, Stopped, Migrating, Error, Unknown, Shutdowned, Destroyed e Expunging."></a>
                        </div>
                        <div class="ibox-content vm-feature-box">
                            <table class="table table-bordered" >
                                <thead>
                                    <tr>
                                        <th>State</th>
                                        <th>Instances</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="vm-feature" ng-class="{'feature-filter': instanceCtrl.isFilteredField('state', item.name)}"  ng-repeat="item in instanceCtrl.getVmCountByFeature('state') | orderBy:'-count'" >
                                        <td ng-click="instanceCtrl.filter('state', item.name)">{[item.name]}</td>
                                        <td ng-click="instanceCtrl.filter('state', item.name)">{[item.count]}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4" >
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Zones</h5>
                            <a class="fa fa-question-circle tip" data-toggle="tooltip" data-placement="top" title="" data-original-title="Unidade que organiza o datacenter em zonas de disponibilidade com benefício de isolamento físico e redundância de infraestrutura."></a>
                        </div>
                        <div class="ibox-content vm-feature-box">
                            <table class="table table-bordered" >
                                <thead>
                                    <tr>
                                        <th>Zone name</th>
                                        <th>Instances</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="vm-feature" ng-class="{'feature-filter': instanceCtrl.isFilteredField('zone_name', item.name)}"  ng-repeat="item in instanceCtrl.getVmCountByFeature('zonename') | orderBy:'-count'" >
                                        <td ng-click="instanceCtrl.filter('zone_name', item.name)">{[item.name]}</td>
                                        <td ng-click="instanceCtrl.filter('zone_name', item.name)">{[item.count]}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- endrow1 -->
            <!-- startrow2 -->
            <div class="row">
                <div class="col-lg-4" >
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Operational System</h5>
                            <a class="fa fa-question-circle tip" data-toggle="tooltip" data-placement="top" title="" data-original-title="Sistema operacional e versão em execução na instância."></a>
                        </div>
                        <div class="ibox-content vm-feature-box">
                            <table class="table table-bordered" >
                                <thead>
                                    <tr>
                                        <th>Operational System</th>
                                        <th>Instances</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="vm-feature" ng-class="{'feature-filter': instanceCtrl.isFilteredField('os_type_name', item.name)}"  ng-repeat="item in instanceCtrl.getVmCountByFeature('ostypename') | orderBy:'-count'" >
                                        <td ng-click="instanceCtrl.filter('os_type_name', item.name)">{[item.name]}</td>
                                        <td ng-click="instanceCtrl.filter('os_type_name', item.name)">{[item.count]}</td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
                <div class="col-lg-4" >
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>HA</h5>
                            <a class="fa fa-question-circle tip" data-toggle="tooltip" data-placement="top" title="" data-original-title="Com HA habilitado, o IaaS detecta eventos de crash da instância e reinicia a VM automaticamente na mesma zona de disponibilidade."></a>
                        </div>
                        <div class="ibox-content vm-feature-box">
                            <table class="table table-bordered" >
                                <thead>
                                    <tr>
                                        <th>High Availability</th>
                                        <th>Instances</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="vm-feature" ng-class="{'feature-filter': instanceCtrl.isFilteredField('ha_enabled', item.name)}" ng-repeat="item in instanceCtrl.getVmCountByFeature('haenable') | orderBy:'-count'" >
                                        <td ng-click="instanceCtrl.filter('ha_enabled', item.name)">{[item.name == 'true' ? 'Enabled' : 'Disabled']}</td>
                                        <td ng-click="instanceCtrl.filter('ha_enabled', item.name)">{[item.count]}</td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
                <div class="col-lg-4" >
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Hosts</h5>
                            <a class="fa fa-question-circle tip" data-toggle="tooltip" data-placement="top" title="" data-original-title="Host físico no qual a instância está hospedada."></a>
                        </div>
                        <div class="ibox-content vm-feature-box">
                            <table class="table table-bordered" >
                                <thead>
                                    <tr>
                                        <th>Host name</th>
                                        <th>Instances</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="vm-feature" ng-class="{'feature-filter': instanceCtrl.isFilteredField('host_name', item.name)}" ng-repeat="item in instanceCtrl.getVmCountByFeature('hostname') | orderBy:'-count'" >
                                        <td ng-click="instanceCtrl.filter('host_name', item.name)">{[item.name]}</td>
                                        <td ng-click="instanceCtrl.filter('host_name', item.name)">{[item.count]}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4" ></div>
            </div>
            <!-- endrow2 -->

            <!-- startrow3 -->
            <div class="row">
                <div class="col-lg-12" >
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Instances</h5>
                        </div>
                        <div class="ibox-content">
                            <table datatable="ng" dt-options="dtOptions" class="table table-striped table-bordered table-hover dataTables-example">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Operational System</th>
                                        <th>Compute Offering</th>
                                        <th>Host</th>
                                        <th>Zone</th>
                                        <th>HA</th>
                                        <th>State</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="instance in instanceCtrl.getInstances()" >
                                        <td>{[instance.name]}</td>
                                        <td>{[instance.os_type_name]}</td>
                                        <td>{[instance.service_offering_name || '-']}</td>
                                        <td>{[instance.host_name || '-']}</td>
                                        <td>{[instance.zone_name]}</td>
                                        <td>{[instance.ha_enabled ? 'Enabled' : 'Disabled']}</td>
                                        <td>
                                            <span ng-class="{Running:'label label-primary', Stopped:'label label-danger'}[instance.state]">
                                                {[instance.state]}
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div><!-- endrow3 -->
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function(){
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>